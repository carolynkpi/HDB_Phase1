---
title: "Singapore HDB Flat Resale Price Analysis - Part 1"
author: "Carolyn Koay"
date: "20 January 2018"
output: rmarkdown::github_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Data Preparation

Data source: <https://data.gov.sg/dataset/resale-flat-prices>

Data time range: Jan 2015 - Nov 2017

Libraries used: 
```{r message = FALSE, warning = FALSE}
library(dplyr)
```

Here are the variables in the data loaded in. 
```{r echo=FALSE}
file1 = 'resale_prices_2015_.csv'
data = read.csv(file1)
print(names(data))
```

Data is read with stringsAsFactors = TRUE by default. Variables that should not be factor type are changed back to character type. 
```{r}
data[['block']] = sapply(data[['block']], as.character)
data[['street_name']] = sapply(data[['street_name']], as.character)
```

Date comes in "YYYY-mm" format in factor type. 
```{r}
str(data[['month']])
```
The following code convert it to a "YYYY-mm-dd" in character type and date type. Day is treated to be "01" but it shall bear no significance. 
```{r}
data[['date_char']] = sapply(data[['month']], as.character)
data[['date_char']] = paste(data[['date_char']], "-01",sep="")
data['date']=as.Date(data[['date_char']],"%Y-%m-%d")

dates = data.frame(matrix(unlist(strsplit(data[['date_char']],'-')),nrow = dim(data)[1], byrow=TRUE),stringsAsFactors = TRUE)
colnames(dates) = c('year','month','day')
data = cbind(dates[,-3], data[,-1])
remove(dates)
```
```{r}
str(data[['date_char']])
str(data[['date']])
```

Create new variables. 
```{r}
data['floor_area_sqft'] = data['floor_area_sqm']*10.7639
data['age']=as.integer(format(Sys.Date(),'%Y'))-data['lease_commence_date']
data['total_lease']=data['age']+data['remaining_lease']
data ['price_per_sqft'] = data['resale_price']/data['floor_area_sqft']
```

Let's map the 26 towns to 5 main regions per HDB's categorization.  
<http://www.hdb.gov.sg/cs/infoweb/about-us/history/hdb-towns-your-home>
```{r echo = FALSE}
file2 = 'regions_town.csv'
regions = read.csv(file2)
print(regions)
```

```{r}
data = full_join(data,regions,by='town')
```

Bin continuous data.
```{r}
year_break = seq(as.integer(min(data$lease_commence_date)/10)*10,as.integer(max(data$lease_commence_date)/10)*10+10,10)
year_bin = cut(data[['lease_commence_date']],year_break)
year_bin_names = paste(as.character(year_break[-length(year_break)]),'s',sep='')
levels(year_bin)=year_bin_names
data['lease_commence_year_bin'] = year_bin
remove(year_break, year_bin, year_bin_names)

remaining_lease_break = seq(as.integer(min(data$remaining_lease)/10)*10,as.integer(max(data$remaining_lease)/10)*10+10,10)
remaining_lease_bin = cut(data[['remaining_lease']],remaining_lease_break)
data['remaining_lease_bin'] = remaining_lease_bin
remove(remaining_lease_break, remaining_lease_bin)

age_break = seq(as.integer(min(data$age)/10)*10,as.integer(max(data$age)/10)*10+10,10)
age_bin = cut(data[['age']],age_break)
data['age_bin'] = age_bin
remove(age_break, age_bin)

sqft_break = c(250,500,750,1000,1250,1500, max(data[['floor_area_sqft']]))
sqft_bin = cut(data[['floor_area_sqft']],sqft_break)
sqft_bin_names = paste(as.character(sqft_break),as.character(sqft_break+250), sep="-")
sqft_bin_names = c(sqft_bin_names[1:(length(sqft_bin_names)-2)],">1500")
levels(sqft_bin)=sqft_bin_names 
data['sqft_bin'] = sqft_bin
remove(sqft_break, sqft_bin,sqft_bin_names)

lower = as.integer(min(data$resale_price)/100000)*100000
higher = as.integer(max(data$resale_price)/100000)*100000 + 100000
resale_price_break = seq(lower,higher,100000)
resale_price_bin = cut(data[['resale_price']],resale_price_break)
resale_price_bin_names = paste(as.character(resale_price_break/1000),'-',as.character(resale_price_break/1000+100),'k',sep='')
levels(resale_price_bin) = resale_price_bin_names[-length(resale_price_bin_names)]
data['resale_price_bin'] = resale_price_bin

lower = as.integer(min(data$price_per_sqft)/100)*100
higher = as.integer(max(data$price_per_sqft)/100)*100 + 100
price_psf_break = seq(lower,higher,100)
price_psf_bin = cut(data[['price_per_sqft']],price_psf_break)
data['price_psf_bin'] = price_psf_bin
```

Let's take a look at the final data. 
```{r}
str(data)
summary(data)
```
Wow, no missing values in the factor and numeric variables. 
Let's check for missing values in the character variables. 
```{r}
sum(is.na(data$block))
sum(is.na(data$street_name))
```
The data is very clean! Thank you data.gov.sg!!!

Now save the cleaned data for use later. 
```{r}
write.csv(data,'cleaned_data.csv',row.names=FALSE)
classes = sapply(data,class)
write.csv(classes, 'cleaned_data_classes.csv')
save(data,file = 'cleaned_data')
```

<br><br>
___End of part 1___
<br><br>

